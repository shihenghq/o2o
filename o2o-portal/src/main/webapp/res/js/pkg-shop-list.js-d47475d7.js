!function(a){var e=e||{},o=location.hostname.indexOf("meilishuo")>=0?"mlspc":"mgjpc";e.feedList=function(){var e,t={},d={$feedList:a("#J_ShopFeedList"),bottomHeight:200,pack:1,isLoading:!1,hasData:!0,page:parseInt(a("#pageindex").val())||1,loadType:"",order:a(".shop-feed .current").data("order")||"",categoryId:a("#categoryId").val()||"",shopId:a("#shopId").val()},s=function(s){e=a.extend({},d,s),t.page=e.page,t.pack=e.pack,t.order=e.order,t.categoryId=e.categoryId,t.shopId=e.shopId,t.shopwebtag=1,t.platform=o,e.isLoading||(e.isLoading=!0,a.ajax({url:"ajax/feeds/1",data:t,type:"GET",dataType:"json",success:function(o){if(o&&o.success)if(!o||!o.data.goodsList||o.data.goodsList.length<=0)a("#shopFeed").hide(),a("#J_ShopEmpty").show(),e.hasData=!1;else{c(o.data);for(var t=o.data.goodsList,d=[],s=[],i=[],n=0,r=t.length;r>n;n++)d.push(t[n].acm),s.push(t[n].iid),i.push(t[n].index);logger.log(8e3,{acms:d,iids:s,indexs:i})}},complete:function(a,o){e.isLoading=!1}}))},i=function(a){var e="";if(a&&a.length){for(var o=0;o<a.length;o++){var t=a[o];0!=t.discount?$discHtml='<span class="discount">'+t.discount+"折</span>":$discHtml="",$dom='<div class="item i_w_f youdian" tid="0" iid=""><a href="'+t.link+'" class="img mls-item" target="_blank">'+(t.hasTag?'<span class="icon_event_lefttop iwf_icon_taglist"><img src="'+(t.tagImage||"")+'"></span>':"")+'<img width="225" class="mls-img" src="'+(t.fullImage?t.fullImage:t.image)+'" alt="'+t.description+'"></a><div class="favorite" style="position: relative;"><a class="favaImg" href="javascript:;" data-tradeitemid="'+t.iid+'" tradeitemid="'+t.iid+'" tid="0"></a></div><p class="title"><a href="http://shop.mogujie.com/detail/'+t.iid+'" target="_blank">'+t.title+'</a></p><div class="goods-info clearfix"><b class="price"><i>￥</i>'+t.price+"</b>"+$discHtml+'<span class="fav-num">'+t.cfav+"</span></div> </div>",e+=$dom}return e}},n=function(){a.ajax({url:"http://www.mogujie.com/trade/shopweb_index/goodsrecommend",type:"get",dataType:"jsonp",jsonp:"callback",data:{shopId:a("#shopId").val(),itemInfoIds:a("#itemInfoIds").val()},success:function(e){if(e&&e.success){if(!e||!e.data.recommendGoods||e.data.recommendGoods.length<=0)return;var o=i(e.data.recommendGoods),t=a("#J_ShopGoodsRecommend");if(t.length<=0)return;t.show().find(".list").html(o)}}})},c=function(o){var t=i(o.goodsList);if("scroll"==e.loadType?e.$feedList.append(t):e.$feedList.html(t),o.data.isEnd){e.hasData=!1;var d=Math.ceil(o.data.total/100);if(d>1){var s="";e.page>1&&(s=s+'<a href="?sort=desc&categoryId='+e.categoryId+"&order="+e.order+"&page="+parseInt(e.page-1)+'#shopFeed" rel="nofollow"><</a>');for(var n=1;d>=n;n++)s=n==e.page?s+'<a class="c">'+n+"</a>":s+'<a href="?sort=desc&categoryId='+e.categoryId+"&order="+e.order+"&page="+n+'#shopFeed" rel="nofollow">'+n+"</a>";e.page<d&&(s=s+'<a href="?sort=desc&categoryId='+e.categoryId+"&order=hotSales_it&page="+(parseInt(e.page)+1)+'#shopFeed" rel="nofollow">下一页&gt;</a>'),a(".pagination").append(s)}}},r=function(o){e=a.extend({},d,o),a(window).on("scroll",function(){var a,o,t;a=document.body.scrollHeight,o=document.body.scrollTop||document.documentElement.scrollTop,t=document.body.clientHeight>=a?document.documentElement.clientHeight:document.body.clientHeight,e&&a-o-t<e.bottomHeight&&e.hasData&&!e.isLoading&&s({loadType:"scroll",pack:++e.pack})})};return{init:function(){var e=a("#goodsRecommend").val(),o=a("#isEnd").val();e&&n(),1!=o&&r()}}}(),a(document).ready(function(){e.feedList.init();var o;try{o=a.parseJSON(a("#monitorDatas").val())}catch(t){o={}}logger.log(8e3,o)})}(jQuery);